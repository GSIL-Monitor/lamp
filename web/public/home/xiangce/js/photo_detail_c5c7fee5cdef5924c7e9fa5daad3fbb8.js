define("common/js/normalize",[],function(){function t(t,e,i){if(t.match(a)||t.match(r))return t;t=s(t);var p=i.match(r),c=e.match(r);return!c||p&&p[1]==c[1]&&p[2]==c[2]?n(o(t,e),i):o(t,e)}function o(t,o){if("./"==t.substr(0,2)&&(t=t.substr(2)),t.match(a)||t.match(r))return t;var n=o.split("/"),e=t.split("/");for(n.pop();curPart=e.shift();)".."==curPart?n.pop():n.push(curPart);return n.join("/")}function n(t,o){var n=o.split("/");for(n.pop(),o=n.join("/")+"/",i=0;o.substr(i,1)==t.substr(i,1);)i++;for(;"/"!=o.substr(i,1);)i--;o=o.substr(i+1),t=t.substr(i+1),n=o.split("/");var e=t.split("/");for(out="";n.shift();)out+="../";for(;curPart=e.shift();)out+=curPart+"/";return out.substr(0,out.length-1)}var e=/([^:])\/+/g,s=function(t){return t.replace(e,"$1/")},r=/[^\:\/]*:\/\/([^\/])*/,a=/^(\/|data:)/,p=function(o,n,e){n=s(n),e=s(e);for(var i,r,o,a=/@import\s*("([^"]*)"|'([^']*)')|url\s*\((?!#)\s*(\s*"([^"]*)"|'([^']*)'|[^\)]*\s*)\s*\)/gi;i=a.exec(o);){r=i[3]||i[2]||i[5]||i[6]||i[4];var p;p=t(r,n,e);var c=i[5]||i[6]?1:0;o=o.substr(0,a.lastIndex-r.length-c-1)+p+o.substr(a.lastIndex-c-1),a.lastIndex=a.lastIndex+(p.length-r.length)}return o};return p.convertURIBase=t,p.absoluteURI=o,p.relativeURI=n,p}),define("common/js/require-css",[],function(){if("undefined"==typeof window)return{load:function(t,o,n){n()}};var t=document.getElementsByTagName("head")[0],o=window.navigator.userAgent.match(/Trident\/([^ ;]*)|AppleWebKit\/([^ ;]*)|Opera\/([^ ;]*)|rv\:([^ ;]*)(.*?)Gecko\/([^ ;]*)|MSIE\s([^ ;]*)|AndroidWebKit\/([^ ;]*)/)||0,n=!1,e=!0;o[1]||o[7]?n=parseInt(o[1])<6||parseInt(o[7])<=9:o[2]||o[8]?e=!1:o[4]&&(n=parseInt(o[4])<18);var i={};i.pluginBuilder="./css-builder";var s,r,a,p=function(){s=document.createElement("style"),t.appendChild(s),r=s.styleSheet||s.sheet},c=0,u=[],l=function(t){c++,32==c&&(p(),c=0),r.addImport(t),s.onload=function(){h()}},h=function(){a();var t=u.shift();return t?(a=t[1],void l(t[0])):void(a=null)},d=function(t,o){if(r&&r.addImport||p(),r&&r.addImport)a?u.push([t,o]):(l(t),a=o);else{s.textContent='@import "'+t+'";';var n=setInterval(function(){try{s.sheet.cssRules,clearInterval(n),o()}catch(t){}},10)}},m=function(o,n){var i=document.createElement("link");if(i.type="text/css",i.rel="stylesheet",e)i.onload=function(){i.onload=function(){},setTimeout(n,7)};else var s=setInterval(function(){for(var t=0;t<document.styleSheets.length;t++){var o=document.styleSheets[t];if(o.href==i.href)return clearInterval(s),n()}},10);i.href=o,t.appendChild(i)};return i.normalize=function(t,o){return".css"==t.substr(t.length-4,4)&&(t=t.substr(0,t.length-4)),o(t)},i.load=function(t,o,e,i){(n?d:m)(o.toUrl(t+".css"),e)},i}),define("common/js/require-css!web_old_tip",[],function(){}),define("web_old_tip",["css!web_old_tip"],function(){function t(t){e.html(t.text||"&nbsp;"),n[0].className="qui-tip-box","error"==t.type?n.addClass("qui-tip-box-error"):"warning"==t.type&&n.addClass("qui-tip-box-warning")}var o,n,e,i=jQuery;!function(){var t=['<div class="qui-tip" style="display:none;" >','<div class="qui-tip-box">','<span class="qui-tip-text fontYaHei">这里是提示文本</span>',"</div>","</div>"].join("");o=i(t),e=o.find(".qui-tip-text"),n=o.find(".qui-tip-box"),o.appendTo(document.body)}();var s={_timer:null,tip:function(n){return t(n),o.slideDown(200),window.clearTimeout(this._timer),this._timer=setTimeout(function(){o.slideUp(200)},n.time||3e3),this}};return s}),define("project/js/ajaxData",["web_old_tip"],function(t){var o=function(o){return t.tip({text:o,type:"error"})},n=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"get",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"json";"get"==e&&$.extend(n,{timer:+new Date});var s=$.Deferred();return $.ajax({url:t,data:n,type:e,dataType:i}).done(function(t){"json"==i?0==t.error_code?s.resolve(t.data):(console&&console.error(t.data.msg||t.error_code),t.data&&t.data.msg&&o(t.data.msg),s.reject(t)):s.resolve(t)}).fail(function(t){console&&console.error(t),s.reject(t)}),s},e=function(t,o,e){return n(t,o,"get",e)},i=function(t,o,e){return n(t,o,"post",e)},s={allPhotoList:"/index/list",ungroupedPhotoList:"/index/listnoalbumphoto",albumPhotoList:"/album/photos",likePhotoList:"/index/likeList",albumList:"/album/list",photoList:"/index/photoList",noalbumPhotoList:"/index/noalbumPhotoList",albumNameSave:"/album/save",addAlbum:"/album/addPhoto",delAlbum:"/album/del",setCover:"/album/setCover",searchphotopoi:"/qcross/pictrip/album.php?action=searchphotopoi",addPhotoPoi:"/qcross/pictrip/album.php?action=batcheditalbum",photoComment:"/qcross/pictrip/bbs/photo/photocomment",likePhoto:"/qcross/pictrip/bbs/photo/like",delComment:"/qcross/pictrip/album.php?action=rmphotocomment",photoStream:"/index/detailroll",reportPhoto:"/qcross/www/u/api.php?action=jubao",delPhoto:"/index/del",removePhoto:"/album/removePhoto"},r={allPhotoList:function(t){return e(s.allPhotoList,t)},ungroupedPhotoList:function(t){return e(s.ungroupedPhotoList,t)},albumPhotoList:function(t){return e(s.albumPhotoList,t)},likePhotoList:function(t){return e(s.likePhotoList,t)},photoList:function(t){return e(s.photoList,t)},noalbumPhotoList:function(t){return e(s.noalbumPhotoList,t)},albumList:function(t){return e(s.albumList,t)},albumNameSave:function(t){return i(s.albumNameSave,t)},addAlbum:function(t){return i(s.addAlbum,t)},delAlbum:function(t){return i(s.delAlbum,t)},addPhotoPoi:function(t){return i(s.addPhotoPoi,t)},searchphotopoi:function(t){return e(s.searchphotopoi,$.extend(t,{format:"html",isnothaveimg:1}),"html")},photoComment:function(t){return i(s.photoComment,t)},setCover:function(t){return i(s.setCover,t)},likePhoto:function(t){return i(s.likePhoto,t)},delComment:function(t){return i(s.delComment,t)},removePhoto:function(t){return i(s.removePhoto,t)},delPhoto:function(t){return i(s.delPhoto,t)},photoStream:function(t){return e(s.photoStream,t)},reportPhoto:function(t){return i(s.reportPhoto,t)}};return r}),define("common/js/require-css!web_old_slidconfirm",[],function(){}),define("web_old_slidconfirm",["css!web_old_slidconfirm"],function(){function t(t){n.find(".qui-slidConfirm-text").html(t.text||"确定要继续吗？");var e,i=o(t.target),s=i.offset(),r=s.left-n.width()/2+i.width()/2;e=t.down?s.top+i.height():s.top-n.height()-i.height()-8,0>e&&(e=0),n.css({left:r,top:e}),i=s=r=e=null}var o=jQuery,n=null;!function(){var t=['<div class="qui-slidConfirm" style="display:none">','<div class="qui-slidConfirm-title">','<span class="qui-slidConfirm-text">你确认要删除吗</span>',"</div>",'<div class="qui-slidConfirm-bottom">','<input type="button" class="qui-slidConfirm-cancelBtn ui_button_cancel" value="取消" /> ','<input type="button" class="qui-slidConfirm-okBtn ui_button" value="确定" /> ',"</div>","</div>"].join("");n=o(t),n.appendTo(document.body)}();var e={confirm:function(e){return t(e),n.undelegate("click").delegate(".qui-slidConfirm-cancelBtn,.qui-slidConfirm-okBtn","click",function(){-1!=this.className.indexOf("qui-slidConfirm-cancelBtn")?e.onCancel&&e.onCancel():-1!=this.className.indexOf("qui-slidConfirm-okBtn")&&e.onOK&&e.onOK(),n.slideUp(300)}).slideDown(300,function(){o(document).one("click",function(t){var o=t.target||t.srcElement;-1==o.className.indexOf("qui-slidConfirm-")&&(n.hide(),e.onCancel&&e.onCancel())})}),this}};return e});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};define("project/js/detail/comment",["project/js/ajaxData","web_old_slidconfirm"],function(t,o){function n(t){this.pid=t.pid,this.$comment=$(".photo-comment"),this.$commentForm=this.$comment.find(".comment-input"),this.$commentList=this.$comment.find(".comment-list"),this.commentPlaceHolder="我要评论",this.maxInputLen=140,this.init()}var e=window.PHOTOINFO.pid,i=!0,s=function(t,o,n){var e=t.value.length,i=e>n?"#fd756a":"#959595";o.css({color:i}).html(e)},r=function(t,o){i&&($("body").append("<textarea id='js_autoheight_clone'></textarea>"),i=!1);var n=$("#js_autoheight_clone");n.width($(t).width()),n.val($(t).val()),("undefined"==typeof o?"undefined":_typeof(o))&&(_typeof(o.fontSize)&&n.css("font-size",o.fontSize),_typeof(o.lineHeight)&&n.css("line-height",o.lineHeight)),setTimeout(function(){var o=n.get(0).scrollHeight;$(t).height(o)},1)},a=function(t,o,n){if(t.setSelectionRange)t.focus(),t.setSelectionRange(o,n);else if(t.createTextRange){var e=t.createTextRange();e.collapse(!0),e.moveEnd("character",n),e.moveStart("character",o),e.select()}},p=function(t,o){a(t,o,o)};return n.prototype={init:function(){this.bindEvent()},bindEvent:function(){var t=this;t.$commentForm.on("input focus keyup",".txt-comment",function(){s(this,t.$commentForm.find(".text-num > em"),t.maxInputLen)}).on("click",".btn-comment",function(){var o=this,n=t.$commentForm.find(".txt-comment");t.checkComment(n,function(){t.comment({commid:0,type:1,content:n.val(),pid:e},$(o))})}),t.$commentList.on("click",".btn-replycomm",function(){t.showReplyWrap($(this).closest("li").find(".mod_talk_list_reply"))}).on("click",".btn-delcomm",function(){var n=$(this).closest("li").attr("data-commid");o.confirm({text:"您确定要删除吗？",target:this,onOK:function(){t.delComment(n)}})}).on("input focus",".txt-comment",function(){s(this,$(this).closest(".mod_talk_list_reply").find(".text-num > em"),t.maxInputLen)}).on("click",".btn-comment",function(){var o=this,n=$(this).closest(".mod_talk_list_reply").find(".txt-comment");t.checkComment(n,function(){t.comment({commid:parseInt(n.closest("li").attr("data-commid"))||0,type:1,content:n.val(),pid:e},$(o))})}),this.$comment.on("keydown change keyup",".txt-comment",function(){r(this,{fontSize:"14px",lineHeight:"24px"})})},showReplyWrap:function(t){if(t.is(":hidden")){var o=t.find(".ui-input"),n=t.attr("data-uname");$(".mod_talk_list_reply").hide(),t.show(),o.val("回复 @"+n+"："),o[0].focus(),p(o[0],o.val().length)}else t.hide()},comment:function(o,n){var e=this;this.btnLoad(n.parent(),!0),t.photoComment(o).then(function(t){e.btnLoad(n.parent(),!1),window.location.reload()},function(t){return e.btnLoad(n.parent(),!1)})},btnLoad:function(t,o){t.find(".btn-comment")[o?"hide":"show"](),t.find(".btn-comment-loading")[o?"show":"hide"]()},delComment:function(o){t.delComment({type:1,id:o}).then(function(t){window.location.reload()})},checkComment:function(t,o){if(!qyerUtil.isLogin())return qyerUtil.doLogin(),!1;this.hideError(t);var n=t.val().trim().length;n?n>this.maxInputLen?this.showError(t,"内容不超出"+this.maxInputLen+"字"):o&&o():this.showError(t,"请输入评论内容")},showError:function(t,o){t.addClass("input-error"),t.closest(".comment-form").find(".ui-error-text > span").html(o).parent().show()},hideError:function(t){t.removeClass("input-error"),t.closest(".comment-form").find(".ui-error-text").hide()}},n}),define("common/js/require-css!web_old_popup2",[],function(){}),define("web_old_popup2",["css!web_old_popup2"],function(){function t(t){return this.option=t,this.initUI(),this.ui.setUIDefault(this.option),this}var o=jQuery;return t.prototype={option:null,ui:null,initUI:function(){var t=this.ui={$ui:null,$content:null,$box:null,$title:null,$okBtn:null,$cancelBtn:null,$loadBtn:null,$closeIcon:null,defaultWidth:"auto"},n=['<div class="qui-popup2" style="display:none">',"<div>",'<div class="qui-popup2-dt">','<div class="qui-popup2-box">','<div class="qui-popup2-closeIcon">&nbsp;</div>','<div class="qui-popup2-box-title">title</div>','<div class="qui-popup2-box-content">',"</div>",'<div class="qui-popup2-box-bottom">',"&nbsp;",'<input class="qui-popup2-cancelBtn ui_button_cancel" type="button" value="取消" />  ','<input class="qui-popup2-okBtn ui_button" type="button" value="确定" />  ','<input class="qui-popup2-loadingBtn  ui_button_load" type="button" value="" />  ',"</div>","</div>","</div>","</div>","</div>"].join("");return t.$ui=o(n),t.$content=t.$ui.find(".qui-popup2-box-content"),t.$box=t.$ui.find(".qui-popup2-box"),t.$title=t.$ui.find(".qui-popup2-box-title"),t.$okBtn=t.$ui.find(".qui-popup2-okBtn"),t.$cancelBtn=t.$ui.find(".qui-popup2-cancelBtn"),t.$loadBtn=t.$ui.find(".qui-popup2-loadingBtn"),t.$closeIcon=t.$ui.find(".qui-popup2-closeIcon"),t.$bottom=t.$ui.find(".qui-popup2-box-bottom"),t.$ui.appendTo(document.body),t.option=this.option,t=n=null,o.extend(this.ui,{setWidth:function(t){this.$box.animate({width:t},300)},setUIDefault:function(t){this.$ui[0].className="qui-popup2",t.exClassName&&this.$ui.addClass(t.exClassName),t.iframeSrc?this.$content.html('<iframe src="'+t.iframeSrc+'"  scrolling="auto" style="height:'+(t.iframeHeight||300)+'px;"  />'):this.$content.html(t.contentHTML||"&nbsp;"),this.$title.html(t.title||"Title"),this.$box.css("width",t.width||this.defaultWidth),this.$title[t.showTitle===!1?"hide":"show"](),this.$okBtn.val(t.okText||"确定"),this.$cancelBtn.val(t.cancelText||"取消"),this.$okBtn[t.showOKBtn===!1?"hide":"show"](),this.$okBtn.removeAttr("data-bn-ipg"),this.$cancelBtn[t.showCancelBtn===!1?"hide":"show"](),this.$cancelBtn.removeAttr("data-bn-ipg"),this.$loadBtn[t.showLoadBtn===!0?"show":"hide"](),this.$loadBtn.removeAttr("data-bn-ipg"),this.$ui.find(".qui-popup2-closeIcon").removeAttr("data-bn-ipg"),this.$closeIcon[t.showCloseIcon===!1?"hide":"show"](),t.showOKBtn===!1&&t.showCancelBtn===!1&&this.$bottom.hide()},show:function(){var t={},n={top:0},e=this;o.support.leadingWhitespace&&(t.opacity=1,n.opacity=1),this.$ui.css("display","block").animate(t,200,function(){e.$box.css("top",-30).animate(n,200,function(){e.option.onShow&&e.option.onShow(),t=n=e=null})})},hide:function(t){var n={top:-30},e={},i=this;i.option&&i.option.onBeforeHide&&i.option.onBeforeHide()===!1||(o.support.leadingWhitespace&&(n.opacity=0,e.opacity=0),this.$box.animate(n,200,function(){i.$ui.animate(e,200,function(){t?i.$ui.hide():i.$ui.remove(),i.option&&i.option.onAfterHide&&i.option.onAfterHide(),n=e=i=null})}))}}),this},show:function(){var t=this;return this.ui.$ui.undelegate("click").delegate(".qui-popup2-okBtn,.qui-popup2-cancelBtn,.qui-popup2-closeIcon","click",function(o){if(this.className.indexOf("qui-popup2-closeIcon")!=-1||this.className.indexOf("qui-popup2-cancelBtn")!=-1){if(t.option.onBeforeCancel&&!t.option.onBeforeCancel(o))return;t.option.onCancel&&t.option.onCancel()}else if(this.className.indexOf("qui-popup2-okBtn")!=-1&&t.option.onOK&&t.option.onOK()===!1)return;t.ui.hide()}),this.ui.show(),this},hide:function(t){return this.ui.hide(t),this},setContent:function(t){return this.ui.$content.html(t),this},getContent:function(){return this.ui.$content[0]},getButtons:function(){return{okBtn:this.ui.$okBtn[0],cancelBtn:this.ui.$cancelBtn[0],loadBtn:this.ui.$loadBtn[0],closeIcon:this.ui.$ui.find(".qui-popup2-closeIcon")[0]}},setOption:function(t){var n=this.ui,e={width:function(){n.setWidth(t.width)},showTitle:function(){n.$title[t.showTitle===!1?"hide":"show"]()},okText:function(){n.$okBtn.val(t.okText)},cancelText:function(){n.$cancelBtn.val(t.cancelText)},showOKBtn:function(){n.$okBtn[t.showOKBtn===!1?"hide":"show"]()},showCancelBtn:function(){n.$cancelBtn[t.showCancelBtn===!1?"hide":"show"]()},showLoadBtn:function(){n.$loadBtn[t.showLoadBtn===!1?"hide":"show"]()},title:function(){n.$title.html(t.title)},exClassName:function(){n.$ui[0].className="qui-popup2 "+t.exClassName},contentHTML:function(){t.iframeSrc||n.$content.html(t.contentHTML)},iframeSrc:function(){n.$content.html('<iframe src="'+t.iframeSrc+'"  scrolling="auto" style="height:'+(t.iframeHeight||300)+'px;" />')},iframeHeight:function(){n.$content.children("iframe").css("height",t.iframeHeight)},showCloseIcon:function(){n.$closeIcon[t.showCloseIcon===!1?"hide":"show"]()}};for(var i in t)this.option[i]=t[i],"function"==o.type(e[i])&&e[i]();n=e=null}},t}),define("project/components/addPhotoDetailPoiPopup/addPhotoDetailPoiPopup",["web_old_popup2","web_old_tip","project/js/ajaxData"],function(t,o,n){var e=function(t){return o.tip({text:t,type:"error"})},i=function(t){return o.tip({text:t})},s=function(t,o,n){var e=t.value.length,i=e>n?"#fd756a":"#959595";o.css({color:i}).html(e)},r='<div class="ui_album_poiSelect_none">加载中...</div>',a="",p={show:function(t){return"undefined"==typeof t.photoids?void e("没有图片id"):(this.opts=t,this.maxInputLen=t.maxInputLen||140,this.photoids=t.photoids,this.showType=t.showType||"new",this.type=t.type||"",this.placeid=t.placeid||"",void this.showPopup())},showPopup:function(){var o=this,n={showType:this.showType,photoids:this.photoids},e="";"edit"==this.showType&&$.extend(n,{type:this.opts.type,descript:this.opts.descript,placeid:this.opts.placeid,place:this.opts.place}),e=this.getPopupContent(n),this.p=new t({width:520,title:("new"==this.showType?"新增":"编辑")+"照片信息",exClassName:"add-photoinfo-popup",contentHTML:e,onOK:function(){return o.onOk(),!1}}),this.p.show(),this.content=$(this.p.getContent()),this.bindEvent()},bindEvent:function(){var t=this,o=this.content,n=o.find(".txtSearch"),e=o.find(".album_upload_found_place_poiSelect");n.on("input",function(){var o=this;clearTimeout(this.timer),e.show().html(r),this.timer=setTimeout(function(){t.searchPoi(o.value,e)},500)}).on("blur",".txtSearch",function(){e.hide()}),o.on("input focus",".txt-descript",function(){s(this,o.find(".num > em"),t.maxInputLen)}),o.on("click",".poi-clean",function(){n.val(""),o.find(".txt-type").val(""),o.find(".txt-placeid").val(""),o.find(".txt-unjoin").val("1")}),o.on("click",".ui_album_poiSelect_search_list",function(){t.type=this.getAttribute("type"),t.placeid=this.getAttribute("data"),n.val($(this).text().trim()),o.find(".txt-type").val(t.type),o.find(".txt-placeid").val(t.placeid),e.hide(),t.hideErr("place")})},searchPoi:function(t,o){$.trim(t)!=$.trim(a)&&(a=t,n.searchphotopoi({kw:t}).then(function(t){o.html(t)}))},onOk:function(){var t=this;if(!this.checkDescript())return!1;var o={};this.content.find("form").serializeArray().map(function(t,n){o[t.name]=t.value}),this.btnLoading(!0),n.addPhotoPoi(o).then(function(o){t.btnLoading(!1),i(o.msg),t.p.hide(),t.opts.onAddSuccess?t.opts.onAddSuccess(t.photoids):window.location.reload()},function(o){return t.btnLoading(!1)})},btnLoading:function(t){this.p.setOption({showOKBtn:!t,showLoadBtn:t})},checkDescript:function(){var t=this.content.find(".txt-descript");return this.hideErr("descript"),!(t.val().trim().length>this.maxInputLen)||(this.showErr("descript","图片描述不超出"+this.maxInputLen+"字"),!1)},checkPlace:function(){return this.hideErr("place"),""!=this.type&&""!=this.placeid||(this.showErr("place","请选择目的地"),!1)},hideErr:function(t){this.content.find(".txt-"+t).removeClass("input-error"),this.content.find(".err-"+t).hide()},showErr:function(t,o){this.content.find(".txt-"+t).addClass("input-error"),this.content.find(".err-"+t+" > span").html(o).parent().show()},getPopupContent:function(t){return'\n        <div class="popup-content ui-form">\n          <form id="addPhotoPoiForm" action="/">\n          <div class="popup-photoinfo">\n            <textarea class="ui-input txt-descript" name="descript" placeholder="添加照片描述">'+("edit"==t.showType?t.descript:"")+'</textarea>\n            <p class="input-control">\n              <span class="num"><em>0</em>/'+this.maxInputLen+'</span>\n              <span class="ui-error-text err-descript" style="display: none;"><i class="icons icon-error"></i> <span></span></span>\n            </p>\n          </div>\n          <div class="popup-photopoi">\n            <i class="icons icon-position2"></i>\n            <a href="javascript:;" class="poi-clean"><i class="icons icon-clean"></i></a>\n            <input type="hidden" name="type" value="'+t.showType+'" />\n            <input class="txt-photoids" type="hidden" name="photoids" value="'+t.photoids+'" />\n            <input class="txt-placeid" type="hidden" name="placeid" value="'+("edit"==t.showType?t.placeid:"")+'" />\n            <input class="txt-type" type="hidden" name="type" value="'+("edit"==t.showType?t.type:"")+'" />\n            <input class="txt-unjoin" type="hidden" name="unjoin" value="0" />\n            <input type="text" name="place" class="ui-input txtSearch txt-place" placeholder="添加地点" value="'+("edit"==t.showType?t.place:"")+'" />\n            <span class="ui-error-text err-place" style="display: none;"><i class="icons icon-error"></i> <span></span></span>\n            <div id="editphotopoisearch_A" class="album_upload_found_place_poiSelect">\n            </div>\n          </div>\n          </form>\n        </div>\n      '}};return{show:function(t){return p.show(t)}}}),define("project/components/reportPhotoPopup/reportPhotoPopup",["web_old_popup2","web_old_tip","project/js/ajaxData"],function(t,o,n){var e=function(t){return o.tip({text:t,type:"error"})},i=function(t){return o.tip({text:t})},s={show:function(t){return"undefined"==typeof t.photoId?void e("没有图片id"):(this.opts=t,this.photoId=t.photoId,void this.showPopup())},showPopup:function(){var o=this,n=this.getPopupContent();this.p=new t({width:520,title:"举报",exClassName:"report-popup",contentHTML:n,onOK:function(){return o.onOk(),!1}}),this.p.show(),this.content=$(this.p.getContent()),this.bindEvent()},getPopupContent:function(){return'\n        <div class="popup-content ui-form">\n          <form id="reportPhotoForm" action="/">\n          <div class="input-control selector-control">\n            <span>举报原因:</span>\n            <label for="radio_1"><input id="radio_1" name="reason" type="radio" value="广告" /> 广告</label>\n            <label for="radio_2"><input id="radio_2" name="reason" type="radio" value="灌水" /> 灌水</label>\n            <label for="radio_3"><input id="radio_3" name="reason" type="radio" value="色情污秽" /> 色情污秽</label>\n            <label for="radio_4"><input id="radio_4" name="reason" type="radio" value="危害国家安全" /> 危害国家安全</label>\n            <label for="radio_5"><input id="radio_5" name="reason" type="radio" value="其他" /> 其他</label>\n          </div>\n          <div class="input-control">\n            <textarea class="ui-input txt-report" name="reason_other" placeholder="详细的说明会帮助我们更快的处理举报内容"></textarea>\n          </div>\n          </form>\n        </div>\n      '},bindEvent:function(){},onOk:function(){var t=this;void 0==this.content.find("[name=reason]:checked").val()&&e("请选择举报原因"),n.reportPhoto({type:6,id:this.photoId,page_url:window.location.href,reason:this.content.find("[name=reason]:checked").val(),reason_other:this.content.find("[name=reason_other]").val()}).then(function(o){i("感谢举报！我们会尽快处理！"),t.p.hide()})}};return s}),define("project/components/delPhotoPopup/delPhotoPopup",["web_old_popup2","web_old_tip","project/js/ajaxData"],function(t,o,n){var e=function(t){return o.tip({text:t,type:"error"})},i=function(t){return o.tip({text:t})},s={show:function(o){var n=this;return"undefined"==typeof o.photoIds&&"undefined"==typeof o.photoId?void e("没有相册id"):(this.opts=o,this.photoIds=o.photoIds||[o.photoId],this.p=new t({width:410,showTitle:!1,exClassName:"del-confirm-popup",okText:"删除",contentHTML:'<div class="popup-content"><h2>照片将被彻底删除了<br>确定删除该照片？</h2></div>',onOK:function(){return n.delOk()}}),void this.p.show())},delOk:function(){var t=this;return this.btnLoading(!0),n.delPhoto({id:this.photoIds}).then(function(o){t.btnLoading(!1),i(o.msg),t.p.hide(),t.opts.onDelSuccess?t.opts.onDelSuccess(t.photoIds):window.location.reload()},function(o){return t.btnLoading(!1)}),!1},btnLoading:function(t){this.p.setOption({showOKBtn:!t,showLoadBtn:t})}};return{show:function(t){return s.show(t)}}}),define("project/js/detail/DetailAside",["project/js/ajaxData","web_old_tip","project/js/detail/comment","project/components/addPhotoDetailPoiPopup/addPhotoDetailPoiPopup","project/components/reportPhotoPopup/reportPhotoPopup","project/components/delPhotoPopup/delPhotoPopup"],function(t,o,n,e,i,s){function r(t){this.pots=$.extend({container:$("#photoAside")},t),this.photoId=t.photoId,this.$box=this.pots.container,this.init()}var a=function(t){return o.tip({text:t})},p=function(t){e.show(t)},c=function(t){i.show({photoId:t})},u=function(t){s.show({photoId:t,onDelSuccess:function(){a("照片已删除"),window.close()}})},l=function(o){return t.likePhoto(o)},h=function(t,o){var n=t.getAttribute("data-op"),e=parseInt($(t).find("span").text()),i="";"1"==n?(i="icons icon-liked",e++,$(".likePeople").append('<a class="user_'+o.uid+'" href="'+o.userLink+'">'+o.username+",</a>"),t.setAttribute("data-op",0)):(i="icons icon-like",e--,$(".user_"+o.uid).remove(),t.setAttribute("data-op",1)),$(".likeCount").html(e),$(t).find("span").html(e).end().find(".icons")[0].className=i};return new n({pid:window.PHOTOINFO.pid}),r.prototype={init:function(){this.bindEvent()},bindEvent:function(){var t=this,o=this.$box,n=o.find(".like-peoples");o.on("click",".add-position",function(){return qyerUtil.isLogin()?void p({photoids:t.photoId}):(qyerUtil.doLogin(),!1)}).on("click",".edit-position",function(){if(!qyerUtil.isLogin())return qyerUtil.doLogin(),!1;var t={showType:"edit"};$(".formField :hidden").map(function(){t[this.name]=this.value}),p(t)}).on("click",".btn-like",function(){var o=this;return qyerUtil.isLogin()?void l({pid:t.photoId,op:this.getAttribute("data-op")}).then(function(t){h(o,t.user)}):(qyerUtil.doLogin(),!1)}).on("click",".btn-del",function(){return qyerUtil.isLogin()?void u(t.photoId):(qyerUtil.doLogin(),!1)}).on("click",".btn-report",function(){return qyerUtil.isLogin()?void c(t.photoId):(qyerUtil.doLogin(),!1)}),n.on("click",".part .fold",function(){return n.find(".all").show(),n.find(".part").hide(),!1}).on("click",".all .fold",function(){return n.find(".part").show(),n.find(".all").hide(),!1})}},r}),define("project/js/detail/photoStream",["project/js/ajaxData"],function(t){var o={isOn:!1,el:$("#photoStream"),delayLock:!1,batch:20,maxPresentCnt:20,grid:80,padding:10,thumbnails:$("#thumbnails"),thumbShadow:$("#thumbShadow"),stream:[],status:[],reachStart:!1,reachEnd:!1,present:{start:-1,end:-1,selected:-1},presentChange:!1,presentCnt:-1,init:function(t){var o=this;return this.streamSpm=t.spm,this.streamUrl=t.photoStream,this.albumid=t.albumid,this.uid=t.uid,this.stream.push({pid:t.pid,photoThumb:t.photoThumb,photoUrl:t.photoUrl}),this.loadStream(t.pid,"prev",function(n){var e=n.length;o.present.selected=e,o.loadStream(t.pid,"next",function(t){o.setScale().setPresent(e,"center").render(),o.el.find(".photoPrev,.photoNext").fadeIn()}),o.checkBufferStream()}),$("#photoStream .photoPrev").click(function(){o.seePrev()}),$("#photoStream .photoNext").click(function(){o.seeNext()}),this},setScale:function(){var t=Math.floor($("#thumbnails").width()/(this.grid+this.padding));return this.presentCnt=t<=this.maxPresentCnt?t:this.maxPresentCnt,this},checkBufferStream:function(){return!this.reachStart&&this.present.start<this.presentCnt&&this.loadStream(this.stream[this.present.start].pid,"prev",function(){this.checkBufferStream()}),!this.reachEnd&&this.stream.length-this.present.end<this.presentCnt&&this.loadStream(this.stream[this.present.end].pid,"next",function(){this.checkBufferStream()}),this},loadStream:function(o,n,e){var i=this;t.photoStream({spm:i.streamSpm,uid:i.uid,id:o,album_id:i.albumid,dir:n}).then(function(t){var o=t.list;switch(n){case"prev":var s=o.length;i.stream=o.concat(i.stream);for(var r in i.present)i.present[r]+=i.present[r]==-1?0:s;s<i.batch&&(i.reachStart=!0);break;case"next":i.stream=i.stream.concat(o),o.length<i.batch&&(i.reachEnd=!0)}for(var a=0,s=i.status.length;a<s;a++)if(i.status[a]==ajaxstamp){i.status.splice(a,1);break}"function"==typeof e&&e.call(i,o)})},setPresent:function(t,o){var n,e=this.present.start;switch(o){case"prev":n=t;break;case"center":n=Math.ceil((this.presentCnt-1)/2)+t+1;break;case"next":n=t+this.presentCnt+1;break;default:return this}return n=n>this.stream.length?this.stream.length:n,this.present.start=n>this.presentCnt?n-this.presentCnt:0,this.present.end=n>this.presentCnt?n-1:this.presentCnt<=this.stream.length?this.presentCnt-1:this.stream.length-1,this.presentChange=!(e==this.present.start),this},render:function(t){if(!this.presentChange)return this;var o=t?"prev"==t?-1:1:0;this.thumbnails.children().appendTo(this.thumbShadow),this.thumbnails.html("").css({opacity:0,left:100*o});for(var n=this.present.start;n<=this.present.end;n++){var e=$(this.photoThumbTpl(this.stream[n]));n==this.present.selected&&e.addClass("current"),e.appendTo(this.thumbnails)}return this.thumbnails.animate({opacity:1,left:0}),this},photoThumbTpl:function(t){return'<li>\n        <a href="'+t.photoUrl+'">\n          <img src="'+t.photoThumb+'" onerror="this.src=\'//static.qyer.com/images/user/nothing/nothing_cover.png\'" width="80" height="80" />\n        </a>\n      </li>'},seePrev:function(){return this.setScale().setPresent(this.present.start,"prev").render("prev"),this.checkBufferStream(),this},seeNext:function(){return this.setScale().setPresent(this.present.end,"next").render("next"),this.checkBufferStream(),this},show:function(){return this.isOn?this:(this.isOn="showing",this.el.animate({opacity:1,bottom:0},100,function(){this.isOn=!0}),this)},hide:function(){return this.isOn?(this.el.animate({opacity:0,bottom:-40},100),this.isOn=!1,this):this}};return o}),$(function(){var t={photoCell:$(".photo-cell"),photoCellSize:function(t){var o=t.parent(),n=o.width(),e=o.height();t.css({width:n,height:e})},init:function(){var t=this,o=function(){t.photoCellSize(t.photoCell)};o(),t.photoCell.css({display:"table-cell"}),$(window).on("resize",o)}};t.init(),requirejs(["project/js/detail/DetailAside"],function(t){new t({photoId:window.PHOTOINFO.pid,container:$("#photoAside")})}),requirejs(["project/js/detail/photoStream"],function(t){t.init({uid:window.authorUid,pid:window.PHOTOINFO.pid,spm:window.PHOTOINFO.spm,albumid:window.PHOTOINFO.albumid,photoThumb:window.PHOTOINFO.photoThumb,photoUrl:window.PHOTOINFO.photoUrl,photoStream:window.PHOTOINFO.photoStream})}),$(".photo-detail-bottom").on("mouseout mouseover",function(t){"mouseover"===t.type?$(this).addClass("hover"):$(this).removeClass("hover")});var o=$("._js_jiathis_style_share");window.jiathis_config={title:o.attr("data-title"),summary:o.attr("data-summary"),pic:o.attr("data-pic"),url:o.attr("data-url")}}),define("project/js/photoDetail",function(){}),function(t){var o=document,n="appendChild",e="styleSheet",i=o.createElement("style");i.type="text/css",o.getElementsByTagName("head")[0][n](i),i[e]?i[e].cssText=t:i[n](o.createTextNode(t))}(".qui-tip{position:fixed;top:75pt;left:0;width:100%;text-align:center;display:none;z-index:1100}.qui-tip-box{display:inline-block;min-width:90pt;max-width:390px;padding:20px 30px;background-color:#fff;box-shadow:0 2px 7px rgba(0,0,0,.25);border:1px solid silver;text-align:left;font-size:18px;line-height:2pc}.qui-tip-text{display:block;position:relative;padding-left:34px}.qui-tip-text:before{content:'';position:absolute;left:0;top:4px;width:24px;height:24px;background:url(//fed.static.qyer.com/core/web/common/resource/ui/oldtip/icons2.png) no-repeat #fff}.qui-tip-box-error .qui-tip-text:before{background-position:0 -5pc}.qui-tip-box-warning .qui-tip-text:before{background-position:0 -40px}.qui-slidConfirm{position:absolute;z-index:1300;top:75pt;left:75pt;border:1px solid #ccc;padding:10px;background-color:#fff;box-shadow:0 0 6px #aaa}.qui-slidConfirm-bottom{margin-top:10px;text-align:center}.qui-slidConfirm-text{background-image:url(//fed.static.qyer.com/core/web/common/resource/ui/oldslidconfirm/icons.png);background-repeat:no-repeat;display:inline-block;padding-left:20px;background-position:0 -79px;text-align:center}.qui-popup2{position:fixed;top:0;left:0;width:100%;height:100%;background-image:url(//static.qyer.com/models/common/images/bg_255_255_255_0.7.png);z-index:1000;overflow-y:auto;opacity:0}.qui-popup2>div{display:table;height:100%;margin:0 auto}.qui-popup2-dt{display:table-cell;vertical-align:middle}.qui-popup2-box{margin:0 auto;background-color:#fff;position:relative;-webkit-box-shadow:0 0 6px #aaa;-moz-box-shadow:0 0 6px #aaa;box-shadow:0 0 6px #aaa;border:1px solid #ccc;opacity:0}.qui-popup2-loadingBtn,.qui-popup2-okBtn{vertical-align:middle;margin-left:16px}.qui-popup2-box-title{height:70px;line-height:70px;font-size:20px;font-weight:700;padding-left:30px}.qui-popup2-box-content{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;padding:0 30px}.qui-popup2-box-content>iframe{width:100%;border:none}.qui-popup2-box-bottom{text-align:right;height:70px;line-height:70px;padding-right:30px}.qui-popup2-closeIcon{position:absolute;right:10px;top:10px;cursor:pointer;background-image:url(//static.qyer.com/models/common/ui/popup2/icons.png);height:32px;width:32px;background-repeat:no-repeat;background-position:0 -18px;border-radius:5px}.qui-popup2-closeIcon:hover{background-position:0 -65px}.qui-popup2-cancelBtn{vertical-align:middle}.qui-popup2-loadingBtn{display:none}");