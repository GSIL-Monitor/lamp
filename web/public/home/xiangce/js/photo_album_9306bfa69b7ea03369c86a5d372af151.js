$(function(){var t={photoBox:$(".photo-box"),photoboxHeight:function(t){var o=Math.max(document.body.offsetHeight,document.documentElement.offsetHeight),n=o-t.offsetTop-45-5;$(".q-layer-header").length&&(n-=$(".q-layer-header").height()),document.getElementById("zpui-head-ad")&&(n-=document.getElementById("zpui-head-ad").offsetHeight),t.style.height=n+"px"},init:function(){var t=this,o=function(){t.photoboxHeight(t.photoBox[0])};t.photoBox.length&&(o(),$(window).on("resize",o)),document.getElementById("zpui-head-ad-close")&&$("#zpui-head-ad-close").on("click",function(){setTimeout(o,310)})}};t.init()}),define("common/js/normalize",[],function(){function t(t,e,i){if(t.match(a)||t.match(s))return t;t=u(t);var r=i.match(s),p=e.match(s);return!p||r&&r[1]==p[1]&&r[2]==p[2]?n(o(t,e),i):o(t,e)}function o(t,o){if("./"==t.substr(0,2)&&(t=t.substr(2)),t.match(a)||t.match(s))return t;var n=o.split("/"),e=t.split("/");for(n.pop();curPart=e.shift();)".."==curPart?n.pop():n.push(curPart);return n.join("/")}function n(t,o){var n=o.split("/");for(n.pop(),o=n.join("/")+"/",i=0;o.substr(i,1)==t.substr(i,1);)i++;for(;"/"!=o.substr(i,1);)i--;o=o.substr(i+1),t=t.substr(i+1),n=o.split("/");var e=t.split("/");for(out="";n.shift();)out+="../";for(;curPart=e.shift();)out+=curPart+"/";return out.substr(0,out.length-1)}var e=/([^:])\/+/g,u=function(t){return t.replace(e,"$1/")},s=/[^\:\/]*:\/\/([^\/])*/,a=/^(\/|data:)/,r=function(o,n,e){n=u(n),e=u(e);for(var i,s,o,a=/@import\s*("([^"]*)"|'([^']*)')|url\s*\((?!#)\s*(\s*"([^"]*)"|'([^']*)'|[^\)]*\s*)\s*\)/gi;i=a.exec(o);){s=i[3]||i[2]||i[5]||i[6]||i[4];var r;r=t(s,n,e);var p=i[5]||i[6]?1:0;o=o.substr(0,a.lastIndex-s.length-p-1)+r+o.substr(a.lastIndex-p-1),a.lastIndex=a.lastIndex+(r.length-s.length)}return o};return r.convertURIBase=t,r.absoluteURI=o,r.relativeURI=n,r}),define("common/js/require-css",[],function(){if("undefined"==typeof window)return{load:function(t,o,n){n()}};var t=document.getElementsByTagName("head")[0],o=window.navigator.userAgent.match(/Trident\/([^ ;]*)|AppleWebKit\/([^ ;]*)|Opera\/([^ ;]*)|rv\:([^ ;]*)(.*?)Gecko\/([^ ;]*)|MSIE\s([^ ;]*)|AndroidWebKit\/([^ ;]*)/)||0,n=!1,e=!0;o[1]||o[7]?n=parseInt(o[1])<6||parseInt(o[7])<=9:o[2]||o[8]?e=!1:o[4]&&(n=parseInt(o[4])<18);var i={};i.pluginBuilder="./css-builder";var u,s,a,r=function(){u=document.createElement("style"),t.appendChild(u),s=u.styleSheet||u.sheet},p=0,l=[],c=function(t){p++,32==p&&(r(),p=0),s.addImport(t),u.onload=function(){h()}},h=function(){a();var t=l.shift();return t?(a=t[1],void c(t[0])):void(a=null)},d=function(t,o){if(s&&s.addImport||r(),s&&s.addImport)a?l.push([t,o]):(c(t),a=o);else{u.textContent='@import "'+t+'";';var n=setInterval(function(){try{u.sheet.cssRules,clearInterval(n),o()}catch(t){}},10)}},m=function(o,n){var i=document.createElement("link");if(i.type="text/css",i.rel="stylesheet",e)i.onload=function(){i.onload=function(){},setTimeout(n,7)};else var u=setInterval(function(){for(var t=0;t<document.styleSheets.length;t++){var o=document.styleSheets[t];if(o.href==i.href)return clearInterval(u),n()}},10);i.href=o,t.appendChild(i)};return i.normalize=function(t,o){return".css"==t.substr(t.length-4,4)&&(t=t.substr(0,t.length-4)),o(t)},i.load=function(t,o,e,i){(n?d:m)(o.toUrl(t+".css"),e)},i}),define("common/js/require-css!web_old_popup2",[],function(){}),define("web_old_popup2",["css!web_old_popup2"],function(){function t(t){return this.option=t,this.initUI(),this.ui.setUIDefault(this.option),this}var o=jQuery;return t.prototype={option:null,ui:null,initUI:function(){var t=this.ui={$ui:null,$content:null,$box:null,$title:null,$okBtn:null,$cancelBtn:null,$loadBtn:null,$closeIcon:null,defaultWidth:"auto"},n=['<div class="qui-popup2" style="display:none">',"<div>",'<div class="qui-popup2-dt">','<div class="qui-popup2-box">','<div class="qui-popup2-closeIcon">&nbsp;</div>','<div class="qui-popup2-box-title">title</div>','<div class="qui-popup2-box-content">',"</div>",'<div class="qui-popup2-box-bottom">',"&nbsp;",'<input class="qui-popup2-cancelBtn ui_button_cancel" type="button" value="取消" />  ','<input class="qui-popup2-okBtn ui_button" type="button" value="确定" />  ','<input class="qui-popup2-loadingBtn  ui_button_load" type="button" value="" />  ',"</div>","</div>","</div>","</div>","</div>"].join("");return t.$ui=o(n),t.$content=t.$ui.find(".qui-popup2-box-content"),t.$box=t.$ui.find(".qui-popup2-box"),t.$title=t.$ui.find(".qui-popup2-box-title"),t.$okBtn=t.$ui.find(".qui-popup2-okBtn"),t.$cancelBtn=t.$ui.find(".qui-popup2-cancelBtn"),t.$loadBtn=t.$ui.find(".qui-popup2-loadingBtn"),t.$closeIcon=t.$ui.find(".qui-popup2-closeIcon"),t.$bottom=t.$ui.find(".qui-popup2-box-bottom"),t.$ui.appendTo(document.body),t.option=this.option,t=n=null,o.extend(this.ui,{setWidth:function(t){this.$box.animate({width:t},300)},setUIDefault:function(t){this.$ui[0].className="qui-popup2",t.exClassName&&this.$ui.addClass(t.exClassName),t.iframeSrc?this.$content.html('<iframe src="'+t.iframeSrc+'"  scrolling="auto" style="height:'+(t.iframeHeight||300)+'px;"  />'):this.$content.html(t.contentHTML||"&nbsp;"),this.$title.html(t.title||"Title"),this.$box.css("width",t.width||this.defaultWidth),this.$title[t.showTitle===!1?"hide":"show"](),this.$okBtn.val(t.okText||"确定"),this.$cancelBtn.val(t.cancelText||"取消"),this.$okBtn[t.showOKBtn===!1?"hide":"show"](),this.$okBtn.removeAttr("data-bn-ipg"),this.$cancelBtn[t.showCancelBtn===!1?"hide":"show"](),this.$cancelBtn.removeAttr("data-bn-ipg"),this.$loadBtn[t.showLoadBtn===!0?"show":"hide"](),this.$loadBtn.removeAttr("data-bn-ipg"),this.$ui.find(".qui-popup2-closeIcon").removeAttr("data-bn-ipg"),this.$closeIcon[t.showCloseIcon===!1?"hide":"show"](),t.showOKBtn===!1&&t.showCancelBtn===!1&&this.$bottom.hide()},show:function(){var t={},n={top:0},e=this;o.support.leadingWhitespace&&(t.opacity=1,n.opacity=1),this.$ui.css("display","block").animate(t,200,function(){e.$box.css("top",-30).animate(n,200,function(){e.option.onShow&&e.option.onShow(),t=n=e=null})})},hide:function(t){var n={top:-30},e={},i=this;i.option&&i.option.onBeforeHide&&i.option.onBeforeHide()===!1||(o.support.leadingWhitespace&&(n.opacity=0,e.opacity=0),this.$box.animate(n,200,function(){i.$ui.animate(e,200,function(){t?i.$ui.hide():i.$ui.remove(),i.option&&i.option.onAfterHide&&i.option.onAfterHide(),n=e=i=null})}))}}),this},show:function(){var t=this;return this.ui.$ui.undelegate("click").delegate(".qui-popup2-okBtn,.qui-popup2-cancelBtn,.qui-popup2-closeIcon","click",function(o){if(this.className.indexOf("qui-popup2-closeIcon")!=-1||this.className.indexOf("qui-popup2-cancelBtn")!=-1){if(t.option.onBeforeCancel&&!t.option.onBeforeCancel(o))return;t.option.onCancel&&t.option.onCancel()}else if(this.className.indexOf("qui-popup2-okBtn")!=-1&&t.option.onOK&&t.option.onOK()===!1)return;t.ui.hide()}),this.ui.show(),this},hide:function(t){return this.ui.hide(t),this},setContent:function(t){return this.ui.$content.html(t),this},getContent:function(){return this.ui.$content[0]},getButtons:function(){return{okBtn:this.ui.$okBtn[0],cancelBtn:this.ui.$cancelBtn[0],loadBtn:this.ui.$loadBtn[0],closeIcon:this.ui.$ui.find(".qui-popup2-closeIcon")[0]}},setOption:function(t){var n=this.ui,e={width:function(){n.setWidth(t.width)},showTitle:function(){n.$title[t.showTitle===!1?"hide":"show"]()},okText:function(){n.$okBtn.val(t.okText)},cancelText:function(){n.$cancelBtn.val(t.cancelText)},showOKBtn:function(){n.$okBtn[t.showOKBtn===!1?"hide":"show"]()},showCancelBtn:function(){n.$cancelBtn[t.showCancelBtn===!1?"hide":"show"]()},showLoadBtn:function(){n.$loadBtn[t.showLoadBtn===!1?"hide":"show"]()},title:function(){n.$title.html(t.title)},exClassName:function(){n.$ui[0].className="qui-popup2 "+t.exClassName},contentHTML:function(){t.iframeSrc||n.$content.html(t.contentHTML)},iframeSrc:function(){n.$content.html('<iframe src="'+t.iframeSrc+'"  scrolling="auto" style="height:'+(t.iframeHeight||300)+'px;" />')},iframeHeight:function(){n.$content.children("iframe").css("height",t.iframeHeight)},showCloseIcon:function(){n.$closeIcon[t.showCloseIcon===!1?"hide":"show"]()}};for(var i in t)this.option[i]=t[i],"function"==o.type(e[i])&&e[i]();n=e=null}},t}),define("common/js/require-css!web_old_tip",[],function(){}),define("web_old_tip",["css!web_old_tip"],function(){function t(t){e.html(t.text||"&nbsp;"),n[0].className="qui-tip-box","error"==t.type?n.addClass("qui-tip-box-error"):"warning"==t.type&&n.addClass("qui-tip-box-warning")}var o,n,e,i=jQuery;!function(){var t=['<div class="qui-tip" style="display:none;" >','<div class="qui-tip-box">','<span class="qui-tip-text fontYaHei">这里是提示文本</span>',"</div>","</div>"].join("");o=i(t),e=o.find(".qui-tip-text"),n=o.find(".qui-tip-box"),o.appendTo(document.body)}();var u={_timer:null,tip:function(n){return t(n),o.slideDown(200),window.clearTimeout(this._timer),this._timer=setTimeout(function(){o.slideUp(200)},n.time||3e3),this}};return u}),define("project/js/ajaxData",["web_old_tip"],function(t){var o=function(o){return t.tip({text:o,type:"error"})},n=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"get",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"json";"get"==e&&$.extend(n,{timer:+new Date});var u=$.Deferred();return $.ajax({url:t,data:n,type:e,dataType:i}).done(function(t){"json"==i?0==t.error_code?u.resolve(t.data):(console&&console.error(t.data.msg||t.error_code),t.data&&t.data.msg&&o(t.data.msg),u.reject(t)):u.resolve(t)}).fail(function(t){console&&console.error(t),u.reject(t)}),u},e=function(t,o,e){return n(t,o,"get",e)},i=function(t,o,e){return n(t,o,"post",e)},u={allPhotoList:"/index/list",ungroupedPhotoList:"/index/listnoalbumphoto",albumPhotoList:"/album/photos",likePhotoList:"/index/likeList",albumList:"/album/list",photoList:"/index/photoList",noalbumPhotoList:"/index/noalbumPhotoList",albumNameSave:"/album/save",addAlbum:"/album/addPhoto",delAlbum:"/album/del",setCover:"/album/setCover",searchphotopoi:"/qcross/pictrip/album.php?action=searchphotopoi",addPhotoPoi:"/qcross/pictrip/album.php?action=batcheditalbum",photoComment:"/qcross/pictrip/bbs/photo/photocomment",likePhoto:"/qcross/pictrip/bbs/photo/like",delComment:"/qcross/pictrip/album.php?action=rmphotocomment",photoStream:"/index/detailroll",reportPhoto:"/qcross/www/u/api.php?action=jubao",delPhoto:"/index/del",removePhoto:"/album/removePhoto"},s={allPhotoList:function(t){return e(u.allPhotoList,t)},ungroupedPhotoList:function(t){return e(u.ungroupedPhotoList,t)},albumPhotoList:function(t){return e(u.albumPhotoList,t)},likePhotoList:function(t){return e(u.likePhotoList,t)},photoList:function(t){return e(u.photoList,t)},noalbumPhotoList:function(t){return e(u.noalbumPhotoList,t)},albumList:function(t){return e(u.albumList,t)},albumNameSave:function(t){return i(u.albumNameSave,t)},addAlbum:function(t){return i(u.addAlbum,t)},delAlbum:function(t){return i(u.delAlbum,t)},addPhotoPoi:function(t){return i(u.addPhotoPoi,t)},searchphotopoi:function(t){return e(u.searchphotopoi,$.extend(t,{format:"html",isnothaveimg:1}),"html")},photoComment:function(t){return i(u.photoComment,t)},setCover:function(t){return i(u.setCover,t)},likePhoto:function(t){return i(u.likePhoto,t)},delComment:function(t){return i(u.delComment,t)},removePhoto:function(t){return i(u.removePhoto,t)},delPhoto:function(t){return i(u.delPhoto,t)},photoStream:function(t){return e(u.photoStream,t)},reportPhoto:function(t){return i(u.reportPhoto,t)}};return s}),define("project/components/albumPopup/albumPopup",["web_old_popup2","project/js/ajaxData"],function(t,o){function n(){this.maxInputLen=15}n.prototype={show:function(o){this.p=new t($.extend(this.getPopupOpts(o),this.getPopupEvent())),this.p.show(),this.opts=o,this.content=$(this.p.getContent()),this.bindEvent(this.content)},getPopupOpts:function(t){var o="create"==t.type?"创建相册":"修改相册",n=this.getContentHTML(t.albumName);return{title:o,width:460,showOKBtn:!0,contentHTML:n}},getPopupEvent:function(){var t=this,o=function(){return t.checkAlbumName(t.albumOK),!1},n=function(){},e=function(){t.p=null};return{onOK:o,onCancel:n,onAfterHide:e}},albumOK:function(){var t=this,n={name:this.getAlbumName().val().trim()};"edit"==this.opts.type&&this.opts.albumId&&(n.id=this.opts.albumId),this.btnLoading(!0),o.albumNameSave(n).then(function(o){t.btnLoading(!1),t.p.hide(),t.opts.onSaveSuccess?t.opts.onSaveSuccess(t.getAlbumName().val().trim()):window.location.reload()},function(o){return t.btnLoading(!1)})},btnLoading:function(t){this.p.setOption({showOKBtn:!t,showLoadBtn:t})},getContentHTML:function(t){var o='<div class="ui-form form-album">\n        <p class="input-control">\n          <input type="text" class="ui-input albumName" name="albumName" placeholder="输入相册名称" value="'+t+'"/>\n        </p>\n        <p class="input-control">\n          <span class="num"><em>'+t.length+"</em>/"+this.maxInputLen+'</span>\n          <span class="ui-error-text" style="display: none;"><i class="icons icon-error"></i> <span></span></span>\n        </p>\n      </div>';return o},bindEvent:function(t){var o=this,n=function(t,o,n){var e=t.value.length,i=e>n?"#fd756a":"#959595";o.css({color:i}).html(e)};t.on("input keyup",".albumName",function(){n(this,t.find(".num > em"),o.maxInputLen)})},checkAlbumName:function(t){this.hideError(),this.getAlbumName().val().trim().length?this.getAlbumName().val().trim().length>this.maxInputLen?this.showError("字数不超出"+this.maxInputLen+"字"):t.call(this):this.showError("请输入相册名")},getAlbumName:function(){return this.content.find(".albumName")},showError:function(t){this.content.find(".ui-input").addClass("input-error"),this.content.find(".ui-error-text > span").html(t).parent().show()},hideError:function(){this.content.find(".ui-input").removeClass("input-error"),this.content.find(".ui-error-text").hide()}};var e=new n,i=function(t){return e.show($.extend({type:"create",albumName:""},t))};return{show:i}}),$(function(){var t=function(){requirejs(["project/components/albumPopup/albumPopup"],function(t){t.show({type:"create"})})};$(".btn-createAlbum").on("click",function(){t()})}),define("project/js/photoAlbum",function(){}),function(t){var o=document,n="appendChild",e="styleSheet",i=o.createElement("style");i.type="text/css",o.getElementsByTagName("head")[0][n](i),i[e]?i[e].cssText=t:i[n](o.createTextNode(t))}(".qui-popup2{position:fixed;top:0;left:0;width:100%;height:100%;background-image:url(//static.qyer.com/models/common/images/bg_255_255_255_0.7.png);z-index:1000;overflow-y:auto;opacity:0}.qui-popup2>div{display:table;height:100%;margin:0 auto}.qui-popup2-dt{display:table-cell;vertical-align:middle}.qui-popup2-box{margin:0 auto;background-color:#fff;position:relative;-webkit-box-shadow:0 0 6px #aaa;-moz-box-shadow:0 0 6px #aaa;box-shadow:0 0 6px #aaa;border:1px solid #ccc;opacity:0}.qui-popup2-loadingBtn,.qui-popup2-okBtn{vertical-align:middle;margin-left:16px}.qui-popup2-box-title{height:70px;line-height:70px;font-size:20px;font-weight:700;padding-left:30px}.qui-popup2-box-content{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;padding:0 30px}.qui-popup2-box-content>iframe{width:100%;border:none}.qui-popup2-box-bottom{text-align:right;height:70px;line-height:70px;padding-right:30px}.qui-popup2-closeIcon{position:absolute;right:10px;top:10px;cursor:pointer;background-image:url(//static.qyer.com/models/common/ui/popup2/icons.png);height:32px;width:32px;background-repeat:no-repeat;background-position:0 -18px;border-radius:5px}.qui-popup2-closeIcon:hover{background-position:0 -65px}.qui-popup2-cancelBtn{vertical-align:middle}.qui-popup2-loadingBtn{display:none}.qui-tip{position:fixed;top:75pt;left:0;width:100%;text-align:center;display:none;z-index:1100}.qui-tip-box{display:inline-block;min-width:90pt;max-width:390px;padding:20px 30px;background-color:#fff;box-shadow:0 2px 7px rgba(0,0,0,.25);border:1px solid silver;text-align:left;font-size:18px;line-height:2pc}.qui-tip-text{display:block;position:relative;padding-left:34px}.qui-tip-text:before{content:'';position:absolute;left:0;top:4px;width:24px;height:24px;background:url(//fed.static.qyer.com/core/web/common/resource/ui/oldtip/icons2.png) no-repeat #fff}.qui-tip-box-error .qui-tip-text:before{background-position:0 -5pc}.qui-tip-box-warning .qui-tip-text:before{background-position:0 -40px}");